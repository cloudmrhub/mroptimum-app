FROM public.ecr.aws/lambda/python:3.10

RUN yum update -y \
    && yum install -y git \
    && yum clean all \
    && rm -rf /var/cache/yum

WORKDIR /var/task

COPY requirements.txt .
RUN pip install -r requirements.txt
RUN pip install git+https://github.com/cloudmrhub/mroptimum-tools.git
RUN pip install git+https://github.com/erosmontin/pynico.git
# Copy application code
COPY app.py lambda_function.py

RUN mkdir -p /tmp/.matplotlib && chmod 777 /tmp/.matplotlib
ENV MPLCONFIGDIR=/tmp/.matplotlib

ENV SSL_CERT_FILE=/etc/ssl/certs/ca-bundle.crt
RUN date > /var/task/last_build_date.txt

CMD ["lambda_function.handler"]
